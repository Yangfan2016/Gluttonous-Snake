<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
	<meta charset="UTF-8" />
	<title>贪吃蛇</title>
	<style>
		* {
			padding: 0;
			margin: 0;
		}

		html,
		body {
			width: 100%;
			height: 100%;
			overflow: hidden;
		}

		body {
			background: #ccc;
		}
		.c-panel{
			padding: 20px 0;
		}
		.c-panel .score {
			display: inline-block;
			width: 80px;
			padding: 5px 10px;
			background-color: #524d4da1;			
			color: #f9f9f9;
		}
		.c-drawer{
			background-color: #5585ff;
		}
		.c-controller .btn{
			padding:5px 10px;
			border:none;
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="c-panel">
			<span id="get_score" class="score">000</span>
			<span id="max_score" class="score">000</span>
		</div>
		<div class="c-drawer">
			<canvas id="canvas">您的浏览器不支持canvas</canvas>
		</div>
		<div class="c-controller">
			<button id="btn_reset" class="btn">Restart</button>
			<!-- TODO -->
		</div>
	</div>
	<script src="./dist/snake.min.js"></script>
	<script>
		// DOM加载完成
		function init(e) {
			let canvas = document.getElementById("canvas");
			let ctx = canvas.getContext("2d");
			let btnReset = document.getElementById("btn_reset");
			let labGet = document.getElementById("get_score");
			let labMax = document.getElementById("max_score");

			const VW = window.innerWidth;

			canvas.width = VW;
			canvas.height = VW;

			let timer = null;

			let game = new SnakeGame(canvas, {
				setScore: (score) => {
					labGet.innerHTML = score;
				},
				setMaxScore: (maxScore) => {
					labMax.innerHTML = maxScore;
				},
				clearTimer: () => {
					clearInterval(timer);
				}
			});

			// 初始化UI面板
			labGet.innerHTML = game.score;
			labMax.innerHTML = game.maxScore;

			//  用户操作UI
			document.addEventListener("keydown", function (ev) {
				// 左
				if (ev.keyCode === 37) {
					clearInterval(timer);
					timer = setInterval(function () {
						game.changeToDir('L');
					}, 1000 / game.fps);
				}
				// 上
				if (ev.keyCode === 38) {
					clearInterval(timer);
					timer = setInterval(function () {
						game.changeToDir('T');
					}, 1000 / game.fps);
				}
				// 右
				if (ev.keyCode === 39) {
					clearInterval(timer);
					timer = setInterval(function () {
						game.changeToDir('R');
					}, 1000 / game.fps);
				}
				// 下
				if (ev.keyCode === 40) {
					clearInterval(timer);
					timer = setInterval(function () {
						game.changeToDir('D');
					}, 1000 / game.fps);
				}
			});

			// 重新开始
			btnReset.onclick = function () {
				clearInterval(timer);
				alert("Ready Go!!!");
				// 页面初始化
				game.initFunc();
				game.maxScore = 0;
				game.arrScore = [];
				labMax.innerHTML = game.maxScore + '分';
			};
		}

		window.addEventListener("DOMContentLoaded", init, false);
	</script>
</body>

</html>
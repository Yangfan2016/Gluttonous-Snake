!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.SnakeGame=i()}(this,function(){"use strict";return class{constructor(t,{setScore:i,setMaxScore:h,clearTimer:s}){this.ctx=t.getContext("2d"),this.gridWidth=~~t.width,this.cellWidth=10,this.cellNum=~~(this.gridWidth/this.cellWidth),this.circleRadius=~~(this.cellWidth/2),this.flag=[],this.cx=60,this.cy=240,this.arrX=[],this.arrY=[],this.snake_len=2,this.fps=6,this.score=0,this.count=0,this.arrScore=[],this.maxScore=0,this.setScore=i,this.setMaxScore=h,this.clearTimer=s;for(let t=0,i=this.snake_len;t<i;t++)this.arrX.push(60),this.arrY.push(260-this.cellWidth*t);for(this.coord(),this.drawSnake(this.cx,this.cy,2),this.coordLabel(this.cx,this.cy,this.arrX,this.arrY),this.ax=Math.floor(270*Math.random()+this.cellWidth),this.ay=Math.floor(270*Math.random()+this.cellWidth);1===this.flag[this.ax][this.ay];)this.ax=Math.floor(270*Math.random()+this.cellWidth),this.ay=Math.floor(270*Math.random()+this.cellWidth);this.drawApple(this.ax,this.ay)}circle(t,i,h,s){t.save(),t.beginPath(),t.arc(i.rx,i.ry,i.r,i.start,i.end,i.dir),t.fillStyle=s||"#fff",t.strokeStyle=h||"#666",t.fill(),t.stroke(),t.closePath(),t.restore()}coord(){this.ctx.beginPath();for(let t=0;t<=this.cellNum;t++)this.ctx.moveTo(0,t*this.cellWidth),this.ctx.lineTo(this.gridWidth,t*this.cellWidth),this.ctx.strokeStyle="transparent";this.ctx.stroke(),this.ctx.beginPath();for(let t=0;t<=this.cellNum;t++)this.ctx.moveTo(t*this.cellWidth,0),this.ctx.lineTo(t*this.cellWidth,this.gridWidth),this.ctx.strokeStyle="transparent";this.ctx.stroke()}coordLabel(t,i,h,s){for(let t=0;t<this.gridWidth;t++){this.flag[t]=[];for(let i=0;i<this.gridWidth;i++)this.flag[t][i]=0}this.flag[t][i]=-1;for(let t=0,i=h.length;t<i;t++)this.flag[+h[t]][+s[t]]=1}isStop(t,i){let h=!1;return(t>=297||i>=297||t<=3||i<=3)&&(h=!0),h}drawSnake(t,i,h){this.circle(this.ctx,{rx:t,ry:i,r:this.circleRadius,start:0,end:2*Math.PI},"#333","#26f");for(let t=h-1;t>=0;t--)this.circle(this.ctx,{rx:this.arrX[t],ry:this.arrY[t],r:this.circleRadius,start:0,end:2*Math.PI},"#333","#0c3")}drawApple(t,i){this.circle(this.ctx,{rx:t,ry:i,r:this.circleRadius,start:0,end:2*Math.PI},"#333","#f20")}moveByDir(t){({L:()=>{this.cx=this.cx-this.cellWidth,this.cy=this.cy},T:()=>{this.cx=this.cx,this.cy=this.cy-this.cellWidth},R:()=>{this.cx=this.cx+this.cellWidth,this.cy=this.cy},D:()=>{this.cx=this.cx,this.cy=this.cy+this.cellWidth}})[t]()}initFunc(){this.cx=60,this.cy=240,this.fps=6,this.snake_len=2,this.arrX=[],this.arrY=[];for(let t=0,i=this.snake_len;t<i;t++)this.arrX.push(60),this.arrY.push(260-this.cellWidth*t);this.score=0,this.count=0,this.setScore(this.score),this.ctx.clearRect(0,0,this.gridWidth,this.gridWidth),this.coord(),this.drawSnake(this.cx,this.cy,this.snake_len),this.drawApple(this.ax,this.ay)}changeToDir(t){if(this.ctx.clearRect(0,0,this.gridWidth,this.gridWidth),this.coord(),this.drawApple(this.ax,this.ay),this.isStop(this.cx,this.cy))return this.clearTimer(),alert("Game Over!!!"),void this.initFunc();if(this.drawSnake(this.cx,this.cy,this.snake_len),this.arrX.push(this.cx),this.arrX.shift(),this.arrY.push(this.cy),this.arrY.shift(),this.moveByDir(t),Math.abs(this.cx-this.ax)<=7&&Math.abs(this.cy-this.ay)<=7){if(this.count++,this.score=100*this.count,this.arrScore.push(this.score),this.maxScore=Math.max.apply(null,this.arrScore),this.setScore(this.score),this.setMaxScore(this.maxScore),this.count%5==0)for(this.fps=this.fps+1,this.ax=Math.floor(2*Math.random()*this.cellWidth)+260,this.ay=Math.floor(2*Math.random()*this.cellWidth)+260;1===this.flag[this.ax][this.ay];)this.ax=Math.floor(2*Math.random()*this.cellWidth)+260,this.ay=Math.floor(2*Math.random()*this.cellWidth)+260;else for(this.ax=Math.floor(270*Math.random()+this.cellWidth),this.ay=Math.floor(270*Math.random()+this.cellWidth);1===this.flag[this.ax][this.ay];)this.ax=Math.floor(270*Math.random()+this.cellWidth),this.ay=Math.floor(270*Math.random()+this.cellWidth);this.drawApple(this.ax,this.ay),this.snake_len+=1,this.arrX.push(this.cx),this.arrY.push(this.cy)}this.coordLabel(this.cx,this.cy,this.arrX,this.arrY);for(let t=0,i=this.arrX.length-1;t<i;t++)this.cx===this.arrX[t]&&this.cy===this.arrY[t]&&(this.clearTimer(),alert("蛇撞到自己了"),this.initFunc())}}});
//# sourceMappingURL=snake.min.js.map

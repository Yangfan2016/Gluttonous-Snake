!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.SnakeGame=i()}(this,function(){"use strict";return class{constructor(t,{setScore:i,setMaxScore:s}){this.ctx=t.getContext("2d"),this.cellWidth=10,this.timer=null;let h=~~t.width;h%this.cellWidth!=0&&(h-=h%this.cellWidth,t.width=h,t.height=h),this.gridWidth=h,this.cellNum=~~(this.gridWidth/this.cellWidth),this.circleRadius=~~(this.cellWidth/2),this.flag=[],this.setScore=i,this.setMaxScore=s,this.initFunc()}circle(t,i,s,h){t.save(),t.beginPath(),t.arc(i.rx,i.ry,i.r,i.start,i.end,i.dir),t.fillStyle=h||"#fff",t.strokeStyle=s||"#666",t.fill(),t.stroke(),t.closePath(),t.restore()}coord(){this.ctx.beginPath();for(let t=0;t<=this.cellNum;t++)this.ctx.moveTo(0,t*this.cellWidth),this.ctx.lineTo(this.gridWidth,t*this.cellWidth),this.ctx.strokeStyle="transparent";this.ctx.stroke(),this.ctx.beginPath();for(let t=0;t<=this.cellNum;t++)this.ctx.moveTo(t*this.cellWidth,0),this.ctx.lineTo(t*this.cellWidth,this.gridWidth),this.ctx.strokeStyle="transparent";this.ctx.stroke()}coordLabel(t,i,s,h){for(let t=0;t<=this.gridWidth;t+=this.cellWidth){this.flag[t]=[];for(let i=0;i<=this.gridWidth;i+=this.cellWidth)this.flag[t][i]=0}this.flag[t][i]=-1;for(let t=0,i=s.length;t<i;t++)this.flag[+s[t]][+h[t]]=1}madeRandomCoord(){return~~(Math.random()*(this.cellNum-1)+1)*this.cellWidth}isStop(t,i){let s=!1;return(t>=this.gridWidth||i>=this.gridWidth||t<=this.cellWidth>>1||i<=this.cellWidth>>1)&&(s=!0),s}drawSnake(t,i,s){this.circle(this.ctx,{rx:t,ry:i,r:this.circleRadius,start:0,end:2*Math.PI},"transparent","#26f");for(let t=s-1;t>=0;t--)this.circle(this.ctx,{rx:this.arrX[t],ry:this.arrY[t],r:this.circleRadius,start:0,end:2*Math.PI},"transparent","#0c3")}drawApple(t,i){this.circle(this.ctx,{rx:t,ry:i,r:this.circleRadius,start:0,end:2*Math.PI},"transparent","#f20")}moveByDir(t){({L:()=>{this.cx=this.cx-this.cellWidth,this.cy=this.cy},T:()=>{this.cx=this.cx,this.cy=this.cy-this.cellWidth},R:()=>{this.cx=this.cx+this.cellWidth,this.cy=this.cy},D:()=>{this.cx=this.cx,this.cy=this.cy+this.cellWidth}})[t]()}startToMove(t){clearInterval(this.timer),this.timer=setInterval(()=>{this.changeToDir(t)},1e3/this.fps)}goLeft(){this.startToMove("L")}goTop(){this.startToMove("T")}goRight(){this.startToMove("R")}goDown(){this.startToMove("D")}initFunc(){clearInterval(this.timer),this.snake_len=2,this.fps=6,this.cx=3*this.cellWidth,this.cy=this.gridWidth-this.cx,this.arrX=[],this.arrY=[],this.score=0,this.count=0,this.arrScore=[],this.maxScore=0;for(let t=0,i=this.snake_len;t<i;t++)this.arrX.push(this.cx),this.arrY.push(this.cy+this.cellWidth*this.snake_len-this.cellWidth*t);for(this.ctx.clearRect(0,0,this.gridWidth,this.gridWidth),this.coord(),this.drawSnake(this.cx,this.cy,this.snake_len),this.coordLabel(this.cx,this.cy,this.arrX,this.arrY),this.ax=this.madeRandomCoord(),this.ay=this.madeRandomCoord();1===this.flag[this.ax][this.ay];)this.ax=this.madeRandomCoord(),this.ay=this.madeRandomCoord();this.drawApple(this.ax,this.ay),this.setScore(this.score)}changeToDir(t){if(this.ctx.clearRect(0,0,this.gridWidth,this.gridWidth),this.coord(),this.drawApple(this.ax,this.ay),this.isStop(this.cx,this.cy))return clearInterval(this.timer),alert(`Game Over!!!\n本次得分：${this.score}\n最高分：${this.maxScore}`),void this.initFunc();if(this.drawSnake(this.cx,this.cy,this.snake_len),this.arrX.push(this.cx),this.arrX.shift(),this.arrY.push(this.cy),this.arrY.shift(),this.moveByDir(t),this.cx===this.ax&&this.cy===this.ay){if(this.count++,this.score=100*this.count,this.arrScore.push(this.score),this.maxScore=Math.max.apply(null,this.arrScore),this.setScore(this.score),this.setMaxScore(this.maxScore),this.count%5==0)for(this.fps=this.fps+1,this.ax=this.madeRandomCoord(),this.ay=this.madeRandomCoord();1===this.flag[this.ax][this.ay];)this.ax=this.madeRandomCoord(),this.ay=this.madeRandomCoord();else for(this.ax=this.madeRandomCoord(),this.ay=this.madeRandomCoord();1===this.flag[this.ax][this.ay];)this.ax=this.madeRandomCoord(),this.ay=this.madeRandomCoord();this.drawApple(this.ax,this.ay),this.snake_len+=1,this.arrX.push(this.cx),this.arrY.push(this.cy)}this.coordLabel(this.cx,this.cy,this.arrX,this.arrY);for(let t=0,i=this.arrX.length-1;t<i;t++)this.cx===this.arrX[t]&&this.cy===this.arrY[t]&&(clearInterval(this.timer),alert("蛇撞到自己了"),this.initFunc())}}});
//# sourceMappingURL=snake.min.js.map
